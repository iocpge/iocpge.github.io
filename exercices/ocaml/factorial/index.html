<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Factorielle</title>
    <link rel="stylesheet" href="/codemirror.css">
    <link rel="stylesheet" href="/ocaml-style.css">
    <link rel="stylesheet" href="/material-palenight.css">

</head>
<body>

    <script src="/codemirror.js"></script>
    <script src="/matchbrackets.js"></script>
    <script src="/mllike.js"></script>
    <script src="/toplevel.js"></script> 

<div class="exercise-container">
    <div class="panel left-panel">
        <h1>Factorielle</h1>
        <div class="instructions">
            <h2>Énoncé</h2>
<p>Écrivez une fonction <code>factorielle</code> qui prend un entier <code>n</code> et renvoie sa factorielle ($n!$).</p>
<p>Rappel :</p>
<ul>
<li>$0! = 1$</li>
<li>$n! = n \times (n-1)!$ pour $n &gt; 0$</li>
</ul>
<p>Vérifiez votre code en l'exécutant. Le test final affichera le résultat pour 5 (qui doit être 120).</p>

        </div>
        
        
        <details>
            <summary>Indice</summary>
            <p>Pensez au cas de base : si n est 0 ou 1, la réponse est 1. Sinon, c&#39;est n * f(n-1).</p>
        </details>
        

        
        <details>
            <summary>Solution</summary>
            <pre><code>let rec factorielle n =
  if n &lt;= 1 then 1
  else n * factorielle (n - 1)
</code></pre>
        </details>
        
    </div>

    <div class="panel center-panel" style="padding:0;">
        <div class="editor-toolbar">
            <button id="run-btn">Exécuter ▶</button>
            <button id="reset-btn">Réinitialiser</button>
        </div>
        <textarea id="code-editor">let rec factorielle n =
  (* Votre code ici *)
  0

let () =
  print_int (factorielle 5)
</textarea>
    </div>

    <div class="panel right-panel">
        <div class="output-log" id="output">Initialisation OCaml...</div>
    </div>
</div>


<script>
    var editor = CodeMirror.fromTextArea(document.getElementById('code-editor'), {
        mode: 'text/x-ocaml',
        lineNumbers: true,
        matchBrackets: true,
        theme: 'material-palenight'
    });
  
    var outputDiv = document.getElementById('output-log');
    var runBtn = document.getElementById('run-btn');

    // Cette fonction est appelée AUTOMATIQUEMENT par OCaml quand il y a un print
    window.ocaml_log = function(type, msg) {
        if (!msg || msg.trim() === "") return;
        
        var el = document.createElement('div');
        el.textContent = msg;
        el.className = (type === 'stderr') ? 'error' : 'info';
        
        outputDiv.appendChild(el);
        outputDiv.scrollTop = outputDiv.scrollHeight;
    };

    runBtn.addEventListener('click', function() {
        outputDiv.innerHTML = ''; // Clear output
        var code = editor.getValue();
        
        if (window.ocaml && window.ocaml.run) {
            try {
                // Exécution du code
                var result = window.ocaml.run(code);
                // Affichage du résultat final (valeur de retour)
                if(result && result.trim() !== "") {
                    var el = document.createElement('div');
                    el.textContent = result;
                    el.className = 'success';
                    outputDiv.appendChild(el);
                    outputDiv.scrollTop = outputDiv.scrollHeight;
                }
            } catch (e) {
                console.error(e);
                window.ocaml_log('stderr', "Erreur interne JS: " + e.message);
            }
        } else {
            window.ocaml_log('stderr', "Le compilateur OCaml n'est pas encore chargé. Attendez quelques secondes...");
        }
    });
</script>

</body>
</html>
